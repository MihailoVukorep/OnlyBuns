<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org/">

<head>
    <!-- MAIN -->
    <meta charset="UTF-8">
    <link rel="icon" type="image/x-icon" href="/img/favicon.png">
    <link rel="stylesheet" href="/css/main.css">

    <title>OnlyBuns - Log In</title>
    <link rel="stylesheet" href="/css/login.css">
    <link rel="stylesheet" href="/css/dataform.css">
</head>

<body>
    <div th:replace="~{fragments/navbar :: navbar}"></div>

    <h1>üîë Log In üîë</h1>

    <div class="dataform" id="form_login">
        <table>
            <tr>
                <th>üìß EMAIL / üë§ USERNAME:</th>
                <td><input type="text" id="txt_email" placeholder="email / username" /></td>
            </tr>
            <tr>
                <th>ü§ê PASSWORD:</th>
                <td><input type="text" id="txt_password" placeholder="password" /></td>
            </tr>
        </table>
        <button id="btn_login" onclick="login()">üîë Log In</button>
        <p id="p_status">...</p>
    </div>

    <script>
        let txt_email = document.getElementById("txt_email");
        let txt_password = document.getElementById("txt_password");
        let p_status = document.getElementById("p_status");
        txt_email.focus();
        txt_email.select();

        txt_email.addEventListener("keydown", function (event) {if (event.key == 'Enter') { txt_password.focus(); } }, false);
        txt_password.addEventListener("keydown", function (event) {if (event.key == 'Enter') {login();} }, false);

        async function login() {
            p_status.innerHTML = "Logging in...";

            const response = await fetch('/api/login', {
                method: 'POST',
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({email: txt_email.value, password: txt_password.value})
            });

            const text = await response.text();
            p_status.innerHTML = text;

            if (response.ok) {
                window.location.href = "user";
            }
        }
    </script>
</body>
</html>
