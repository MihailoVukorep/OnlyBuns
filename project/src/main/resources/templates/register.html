<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org/">

<head>
    <!-- MAIN -->
    <meta charset="UTF-8">
    <link rel="icon" type="image/x-icon" href="/img/favicon.png">
    <link rel="stylesheet" href="/css/main.css">

    <title>OnlyBuns - Register</title>
    <link rel="stylesheet" href="/css/register.css">
    <link rel="stylesheet" href="/css/dataform.css">

    <script defer type="text/javascript" src="/js/main.js"></script>
</head>

<body>
    <div th:replace="~{fragments/navbar :: navbar}"></div>

    <h1>üìù Register üìù</h1>
    <div class="dataform" id="form_register">
        <table>
            <tr>
                <th>üìß EMAIL:</th>
                <td><input class="txtfld" type="text" id="txt_email" placeholder="email" /></td>
            </tr>
            <tr>
                <th>üë§ USERNAME:</th>
                <td><input class="txtfld" type="text" id="txt_userName" placeholder="username" /></td>
            </tr>
            <tr>
                <th>ü§ê PASSWORD:</th>
                <td><input class="txtfld" type="text" id="txt_password" placeholder="password" /></td>
            </tr>
            <tr>
                <th>ü§ê REPEAT PASSWORD:</th>
                <td><input class="txtfld" type="text" id="txt_password_repeat" placeholder="repeat password" /></td>
            </tr>
            <tr>
                <th>‚úçÔ∏è FIRST NAME:</th>
                <td><input class="txtfld" type="text" id="txt_firstName" placeholder="first name" /></td>
            </tr>
            <tr>
                <th>‚úçÔ∏è LAST NAME:</th>
                <td><input class="txtfld" type="text" id="txt_lastName" placeholder="last name" /></td>
            </tr>
            <tr>
                <th>üìç ADDRESS:</th>
                <td><input class="txtfld" type="text" id="txt_address" placeholder="address" /></td>
            </tr>
        </table>
        <button id="btn_register" onclick="register()">üìù Register</button>
        <p id="p_status">...</p>
    </div>

    <script>
        async function register() {

            let p_status = document.getElementById("p_status");
            p_status.innerHTML = "Registering...";

            let txt_email = document.getElementById("txt_email");
            let txt_userName = document.getElementById("txt_userName");
            let txt_password = document.getElementById("txt_password");
            let txt_password_repeat = document.getElementById("txt_password_repeat");
            let txt_firstName = document.getElementById("txt_firstName");
            let txt_lastName = document.getElementById("txt_lastName");
            let txt_address = document.getElementById("txt_address");

            if (txt_password.value != txt_password_repeat.value) {
                p_status.innerHTML = "Passwords don't match";
                return;
            }

            const response = await fetch('/api/register', {

                method: 'POST',
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                }

                ,
                body: JSON.stringify({
                    email: txt_email.value,
                    userName: txt_userName.value,
                    password: txt_password.value,
                    firstName: txt_firstName.value,
                    lastName: txt_lastName.value,
                    address: txt_address.value,
                })
            });

            const text = await response.text();
            p_status.innerHTML = text;
        }
    </script>
</body>

</html>
